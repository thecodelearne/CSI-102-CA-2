<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management - Organic Fresh</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-green: #4CAF50;
            --secondary-green: #81C784;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-green), var(--secondary-green));
            color: white;
            padding: 20px 0;
        }
        
        .orders-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .order-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f9f9f9;
        }
        
        .customer-info {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <h1><i class="fas fa-clipboard-list me-2"></i>Order Management</h1>
                <button class="btn btn-light" onclick="window.location.href='index.html'">
                    <i class="fas fa-home me-1"></i>Back to Store
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="orders-section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3><i class="fas fa-receipt me-2"></i>Customer Orders</h3>
                <div>
                    <span class="badge bg-success me-2">Total Orders: <span id="totalOrders">0</span></span>
                    <span class="badge bg-primary">Total Revenue: $<span id="totalRevenue">0.00</span></span>
                </div>
            </div>
            
            <div id="ordersList">
                <div class="text-center text-muted py-5">
                    <i class="fas fa-shopping-cart fa-3x mb-3"></i>
                    <p>No orders yet. Orders will appear here when customers make purchases.</p>
                </div>
            </div>
        </div>

        <div class="orders-section">
            <h4><i class="fas fa-tools me-2"></i>Actions</h4>
            <div class="row">
                <div class="col-md-3">
                    <button class="btn btn-primary w-100" onclick="refreshOrders()">
                        <i class="fas fa-sync me-1"></i>Refresh
                    </button>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-success w-100" onclick="exportOrders()">
                        <i class="fas fa-download me-1"></i>Export CSV
                    </button>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-warning w-100" onclick="clearAllOrders()">
                        <i class="fas fa-trash me-1"></i>Clear All
                    </button>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-info w-100" onclick="addSampleOrder()">
                        <i class="fas fa-plus me-1"></i>Add Sample
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadOrders();
            setInterval(loadOrders, 10000);
        });

        function loadOrders() {
            const orders = JSON.parse(localStorage.getItem('customerOrders') || '[]');
            const ordersList = document.getElementById('ordersList');
            const totalOrders = document.getElementById('totalOrders');
            const totalRevenue = document.getElementById('totalRevenue');

            if (orders.length === 0) {
                ordersList.innerHTML = `
                    <div class="text-center text-muted py-5">
                        <i class="fas fa-shopping-cart fa-3x mb-3"></i>
                        <p>No orders yet. Orders will appear here when customers make purchases.</p>
                    </div>
                `;
                totalOrders.textContent = '0';
                totalRevenue.textContent = '0.00';
                return;
            }

            const revenue = orders.reduce((sum, order) => sum + parseFloat(order.total), 0);
            totalOrders.textContent = orders.length;
            totalRevenue.textContent = revenue.toFixed(2);

            ordersList.innerHTML = orders.reverse().map(order => `
                <div class="order-card">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="customer-info">
                                <h6><i class="fas fa-user me-2"></i>Customer</h6>
                                <p class="mb-1"><strong>Name:</strong> ${order.customer.firstName} ${order.customer.lastName}</p>
                                <p class="mb-1"><strong>Phone:</strong> ${order.customer.phone || 'N/A'}</p>
                                <p class="mb-0"><strong>Address:</strong> ${order.customer.address}, ${order.customer.city} ${order.customer.zipCode}</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <h6><i class="fas fa-shopping-bag me-2"></i>Order Details</h6>
                            <p class="mb-1"><strong>Order ID:</strong> #${order.id}</p>
                            <p class="mb-1"><strong>Date:</strong> ${new Date(order.date).toLocaleDateString()}</p>
                            <p class="mb-1"><strong>Total:</strong> <span class="text-success fw-bold">$${order.total}</span></p>
                            <p class="mb-0"><strong>Payment:</strong> <span class="badge bg-primary">${order.paymentMethod}</span></p>
                        </div>
                        <div class="col-md-4">
                            <h6><i class="fas fa-box me-2"></i>Products</h6>
                            ${order.items.map(item => `
                                <div class="d-flex justify-content-between mb-1">
                                    <span>${item.image} ${item.name}</span>
                                    <span>Qty: ${item.quantity} Ã— $${item.price}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function refreshOrders() {
            loadOrders();
            showAlert('Orders refreshed!', 'success');
        }

        function exportOrders() {
            const orders = JSON.parse(localStorage.getItem('customerOrders') || '[]');
            if (orders.length === 0) {
                showAlert('No orders to export!', 'warning');
                return;
            }

            const csv = [
                ['Order ID', 'Customer', 'Phone', 'Address', 'Products', 'Total', 'Payment', 'Date'],
                ...orders.map(order => [
                    order.id,
                    `${order.customer.firstName} ${order.customer.lastName}`,
                    order.customer.phone || '',
                    `${order.customer.address}, ${order.customer.city} ${order.customer.zipCode}`,
                    order.items.map(item => `${item.name} (${item.quantity})`).join('; '),
                    order.total,
                    order.paymentMethod,
                    new Date(order.date).toLocaleDateString()
                ])
            ].map(row => row.map(field => `"${field}"`).join(',')).join('\n');

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'orders.csv';
            a.click();
            URL.revokeObjectURL(url);
            showAlert('Orders exported!', 'success');
        }

        function clearAllOrders() {
            if (confirm('Delete all orders? This cannot be undone.')) {
                localStorage.removeItem('customerOrders');
                loadOrders();
                showAlert('All orders cleared!', 'warning');
            }
        }

        function addSampleOrder() {
            const orders = JSON.parse(localStorage.getItem('customerOrders') || '[]');
            orders.push({
                id: Date.now(),
                customer: {
                    firstName: 'John',
                    lastName: 'Doe',
                    phone: '+1-555-123-4567',
                    address: '123 Main Street',
                    city: 'New York',
                    zipCode: '10001'
                },
                items: [
                    { name: 'Organic Tomatoes', quantity: 2, price: 3.99, image: 'ðŸ…' },
                    { name: 'Fresh Apples', quantity: 1, price: 4.49, image: 'ðŸŽ' }
                ],
                total: '12.47',
                paymentMethod: 'Credit Card',
                date: new Date().toISOString()
            });
            localStorage.setItem('customerOrders', JSON.stringify(orders));
            loadOrders();
            showAlert('Sample order added!', 'info');
        }

        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} position-fixed`;
            alert.style.cssText = 'top: 20px; right: 20px; z-index: 1050;';
            alert.textContent = message;
            document.body.appendChild(alert);
            setTimeout(() => alert.remove(), 3000);
        }
    </script>
</body>
</html>